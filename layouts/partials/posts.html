{{- $mainSections := .Site.Params.mainSections | default (slice "post") }}
{{- $section := where .Site.RegularPages "Section" "in" $mainSections }}
{{- $section_count := len $section }}
{{- $n_posts := $.Param "recent_posts_number" | default 6 }}
<div class="col-lg-9 col-md-8 col-12 float-md-left pl-md-2">
    <div class="UnderlineNav width-full user-profile-nav top-0 is-placeholder"
        style="visibility: hidden; display: none; height: 56px;"></div>
    <div class="UnderlineNav width-full user-profile-nav js-sticky top-0"
        style="position: static; top: 0px; left: 330.5px; width: 911.5px;">
        <nav class="UnderlineNav-body" data-pjax aria-label="User profile">
            <a aria-current="page" class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3 " href="{{ .Site.BaseURL }}">
                Overview
            </a>
            <a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3 selected" href="{{ absURL "posts/" }}">
                Posts
                <span class="Counter hide-lg hide-md hide-sm">
                    {{ $section_count}}
                </span>
            </a>
            <a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3" href="{{ absURL "tags/" }}">
                Tags
                <span class="Counter hide-lg hide-md hide-sm">
                    {{ len .Site.Taxonomies.tags }}
                </span>
            </a>
            <a class="UnderlineNav-item mr-0 mr-md-1 mr-lg-3 " href="{{ absURL "about/" }}">
                About
            </a>
        </nav>
    </div>

    <div class="position-relative">
        <div id="user-repositories-list">
            <ul data-filterable-for="your-repos-filter" data-filterable-type="substring">
                {{- if eq "Posts" .CurrentSection.Title }}
                    {{- $.Scratch.Set "paginator" (.Paginate (where $section ".Parent.Parent.Title" "Posts")) }}
                {{- else }}
                    {{- $.Scratch.Set "paginator" .Paginator }}
                {{- end -}}

                {{- $paginator := $.Scratch.Get "paginator" -}}

                {{- range $paginator.Pages }}
                <li class="post-item {{ .PublishDate.Format "2006-01-02" }} {{ .Lastmod.Format "2006-01-02" }} col-12 d-flex width-full py-4 border-bottom public fork">
                    <div class="col-12 col-lg-12 d-inline-block">
                        <div class="d-inline-block mb-1">
                            <h3>
                                <a href="{{ .Permalink }}">{{ .Title }}</a>
                            </h3>
                        </div>

                        <div name="posts-post">
                            {{ .Description | safeHTML }}
                        </div>

                        <div class="mb-0 mt-2 f6 text-gray">
                            {{- with .Params.tags }}
                                <span class="f6 text-gray mt-1">
                                    <svg class="octicon octicon-tag" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true">
                                        <path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z" />
                                    </svg>
                                    {{ range . }}<a href="/tags/{{ lower . }}/">{{ . }}</a> {{ end }}
                                </span>
                            {{- end }}
                            <div class="mt-1">
                                Updated <relative-time datetime="{{ .Lastmod.Format "2006-01-02 15:04" }}" class="no-wrap">
                                    {{ .Lastmod.Format "2006-01-02 15:04" }}</relative-time>
                            </div>
                        </div>
                    </div>
                </li>
                {{ end }}
            </ul>
            {{- if gt $paginator.TotalPages 1}}
            <div class="paginate-container">
                <div class="BtnGroup" data-test-selector="pagination">
                    {{- if $paginator.HasPrev }}
                    <a rel="nofollow" class="btn btn-outline BtnGroup-item"
                        href="{{ .Paginator.Prev.URL }}">Previous</a>
                    {{- else }}
                    <button class="btn btn-outline BtnGroup-item" disabled="disabled">Previous</button>
                    {{- end }}
                    {{- if $paginator.HasNext }}
                    <a rel="nofollow" class="btn btn-outline BtnGroup-item" href="{{ $paginator.Next.URL }}">Next</a>
                    {{- else }}
                    <button class="btn btn-outline BtnGroup-item" disabled="disabled">Next</button>
                    {{- end }}
                </div>
            </div>
            {{- end }}
        </div>
    </div>
</div>


<script type="text/javascript">
    function getQueryParam(key) {
        const value = window.location.href.match(new RegExp("[?&]" + key + "=(.*?)(&|$|#)"));
        if (value == null) return '';
        return decodeURIComponent(value[1]);
    }

    function onLoad() {
        const date = getQueryParam("date");
        if (date == '') return;

        // 日付指定がある場合、対象外の物を非表示にする
        const posts = document.getElementsByClassName("post-item");
        [...posts].forEach(post => {
            if (!post.classList.contains(date)) {
                post.parentNode.removeChild(post);
            }
        });
        const container = document.getElementsByClassName("paginate-container");
        [...container].forEach(c => {
            c.parentNode.removeChild(c);
        })
    }

    onLoad();
</script>
